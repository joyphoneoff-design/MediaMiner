# MediaMiner 重建手冊 v1.0

本手冊說明如何從零開始重建 MediaMiner 系統。

---

## 系統需求

- macOS
- Python 3.9+
- 約 2GB 磁碟空間
- 網路連線 (API 調用)

---

## 步驟一：克隆專案

```bash
cd ~
git clone https://github.com/joyphoneoff-design/MediaMiner.git
cd MediaMiner
```

---

## 步驟二：安裝依賴

```bash
# 安裝 Python 依賴
pip3 install -r requirements.txt

# 安裝 yt-dlp (YouTube 下載)
pip3 install yt-dlp

# 安裝 Streamlit (Web UI)
pip3 install streamlit
```

---

## 步驟三：配置 API 密鑰

```bash
# 複製範例配置
cp config/api_keys.env.example config/api_keys.env

# 編輯配置文件
nano config/api_keys.env
```

填入您的 API 密鑰：
```bash
# Gemini API (免費優先)
GEMINI_API_KEY=your_primary_gemini_key
GEMINI_API_KEY_BACKUP=your_backup_gemini_key

# Cerebras Cloud (免費)
CEREBRAS_API_KEY=your_cerebras_key

# OpenAI (付費備用)
OPENAI_API_KEY=your_openai_key

# OpenRouter (免費模型)
OPENROUTER_API_KEY=your_openrouter_key
```

**取得免費 Gemini API 金鑰**: https://aistudio.google.com/apikey

---

## 步驟四：設定執行權限

```bash
chmod +x run.sh
```

---

## 步驟五：驗證安裝

```bash
# 檢查語法
python3 -m py_compile ui/app.py
python3 -m py_compile scrapers/youtube_scraper.py

# 啟動系統
./run.sh
```

開啟 http://localhost:8502 確認 UI 正常顯示。

---

## 目錄結構

```
~/MediaMiner/
├── config/
│   ├── config.yaml           # 主配置
│   ├── api_keys.env          # API 密鑰 (不提交 Git)
│   ├── api_keys.env.example  # API 密鑰範例
│   └── prompts/              # LLM Prompts
├── scrapers/
│   ├── youtube_scraper.py    # YouTube 爬蟲
│   └── transcript_fetcher.py # 逐字稿擷取
├── processors/
│   ├── llm_client.py         # 多提供商 LLM
│   ├── knowledge_extractor.py # 知識提取
│   └── metadata_injector.py  # Metadata 注入
├── integrations/
│   ├── r2r_connector.py      # R2R 連接器
│   └── file_watcher.py       # 檔案監控
├── ui/
│   └── app.py                # Streamlit UI
├── .gitignore                # Git 忽略 (含 api_keys.env)
├── requirements.txt          # Python 依賴
└── run.sh                    # 啟動腳本
```

---

## 依賴服務

確保以下服務正常運行：

| 服務 | 端口 | 檢查指令 |
|------|------|---------|
| R2R | 8001 | `curl http://localhost:8001/v3/health` |
| LM Studio | 1234 | `curl http://localhost:1234/v1/models` |

---

## 故障排除

**Q: Streamlit 無法啟動？**
```bash
pip3 install --upgrade streamlit
streamlit run ui/app.py --server.port 8502
```

**Q: yt-dlp 下載失敗？**
```bash
pip3 install --upgrade yt-dlp
```

**Q: API 密鑰錯誤？**
- 確認 `config/api_keys.env` 格式正確
- 檢查密鑰是否過期或配額用盡

**Q: 如何更新？**
```bash
cd ~/MediaMiner
git pull origin main
pip3 install -r requirements.txt
```

---

## 與其他系統整合

### 完整 Pipeline 流程
```
MediaMiner → MDConverter → MetaEnricher → R2R
  (8502)      (8501)          (CLI)        (8001)
```

### 啟動相關服務
```bash
# MDConverter
cd ~/MDConverter && streamlit run pipeline_webui.py --server.port 8501

# R2R
cd ~/R2R && r2r serve --config-path=r2r_config.toml
```

---

**維護者**: joyphoneoff-design  
**最後更新**: 2025-12-28
