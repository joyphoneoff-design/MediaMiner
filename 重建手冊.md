# MediaMiner 重建手冊 v2.0

本手冊說明如何從零開始重建 MediaMiner 系統。

---

## 系統需求

- macOS (Apple Silicon 推薦)
- Python 3.11+
- 約 3GB 磁碟空間 (含 MLX Whisper 模型)
- 網路連線 (API 調用)

---

## 步驟一：克隆專案

```bash
cd ~
git clone https://github.com/joyphoneoff-design/MediaMiner.git
cd MediaMiner
```

---

## 步驟二：建立虛擬環境

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

### 額外依賴 (Whisper 後端)
```bash
# MLX Whisper (Apple Silicon 本地推理)
pip install mlx-whisper

# 預先下載模型 (避免首次使用時等待)
python -c "import mlx_whisper; mlx_whisper.transcribe('test.mp3', path_or_hf_repo='mlx-community/whisper-large-v3-turbo')" 2>/dev/null || true
```

---

## 步驟三：配置 API 密鑰

```bash
# 複製範例配置
cp config/api_keys.env.example config/api_keys.env

# 編輯配置文件
nano config/api_keys.env
```

必要密鑰：
```bash
# Groq API (Whisper 免費後端 - 推薦)
GROQ_API_KEY=your_groq_key

# LLM 提供商 (至少配一個)
CEREBRAS_API_KEY=your_cerebras_key
GEMINI_API_KEY=your_gemini_key
OPENAI_API_KEY=your_openai_key
```

**取得免費 API：**
- Groq: https://console.groq.com
- Cerebras: https://cloud.cerebras.ai
- Gemini: https://aistudio.google.com/apikey

---

## 步驟四：驗證安裝

```bash
# 啟動系統
source .venv/bin/activate
streamlit run ui/app.py --server.port 8502
```

開啟 http://localhost:8502 確認 UI 正常顯示。

---

## 目錄結構

```
~/MediaMiner/
├── config/
│   ├── api_keys.env          # API 密鑰 (不提交 Git)
│   └── prompts/              # LLM Prompts
├── scrapers/
│   ├── youtube_scraper.py    # YouTube 爬蟲
│   ├── xiaohongshu_scraper.py # 小紅書爬蟲
│   └── transcript_fetcher.py # Whisper 多後端
├── processors/
│   ├── llm_client.py         # 多提供商 LLM
│   ├── knowledge_extractor.py # 知識提取 + 本體論驗證
│   └── metadata_injector.py  # Metadata 注入
├── ui/
│   └── app.py                # Streamlit UI
├── .venv/                    # Python 虛擬環境
├── .gitignore                # Git 忽略
└── requirements.txt          # Python 依賴
```

---

## 本體論配置

MediaMiner 使用 R2R 的本體論進行 entities/tags 驗證：

```
~/R2R/config/ontology/
├── solo_entrepreneur_synonyms.json  # 實體定義
└── solo_entrepreneur_tags.yaml      # 標籤定義
```

若無法載入，系統會使用預設的商業概念清單。

---

## 依賴服務

| 服務 | 端口 | 用途 | 啟動指令 |
|------|------|------|---------|
| R2R | 8001 | RAG 整合 | `cd ~/R2R && r2r serve` |
| LM Studio | 1234 | 本地 LLM | 開啟 LM Studio 應用 |

---

## 故障排除

**Q: MLX Whisper 模型下載失敗？**
```bash
# 手動下載
huggingface-cli download mlx-community/whisper-large-v3-turbo
```

**Q: Groq API 錯誤？**
- 確認 `GROQ_API_KEY` 正確設定
- 檢查 Groq 配額 (每分鐘限制)

**Q: entities/tags 驗證失敗？**
- 確認 `~/R2R/config/ontology/` 目錄存在
- 系統會自動 fallback 到預設清單

---

## 與其他系統整合

### 完整 Pipeline 流程
```
MediaMiner → MDConverter → MetaEnricher → R2R
  (8502)      (8501)          (CLI)        (8001)
```

### 啟動相關服務
```bash
# MDConverter
cd ~/MDConverter && streamlit run pipeline_webui.py --server.port 8501

# MetaEnricher (CLI)
cd ~/MetaEnricher && python smart_processor.py --help

# R2R
cd ~/R2R && r2r serve --config-path=r2r_config.toml
```

---

**維護者**: joyphoneoff-design  
**最後更新**: 2026-01-06
