# å°ç´…æ›¸é »é“å®Œæ•´ä¸‹è¼‰åŠŸèƒ½ - é–‹ç™¼èªªæ˜æ›¸

> ğŸ“… æœ€å¾Œæ›´æ–°ï¼š2025-12-30
> ğŸ”– ç‰ˆæœ¬ï¼šv0.1 (é–‹ç™¼ä¸­)

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

### ç›®æ¨™
å¯¦ç¾é¡ä¼¼ YouTube é »é“æ“·å–çš„åŠŸèƒ½ï¼šè¼¸å…¥å°ç´…æ›¸ç”¨æˆ¶ä¸»é  URLï¼Œè‡ªå‹•ç²å–è©²ç”¨æˆ¶çš„æ‰€æœ‰ç­†è¨˜/å½±ç‰‡åˆ—è¡¨ï¼Œè®“ç”¨æˆ¶é¸æ“‡å¾Œæ‰¹é‡è™•ç†ï¼ˆä¸‹è¼‰å­—å¹•ã€èªéŸ³è¾¨è­˜ã€çŸ¥è­˜æå–ï¼‰ã€‚

### ç•¶å‰ç‹€æ…‹
| é …ç›® | ç‹€æ…‹ | èªªæ˜ |
|------|------|------|
| UI ä»‹é¢ | âœ… å®Œæˆ | å·²æ·»åŠ ã€Œæ–¹å¼ A: å¾ç”¨æˆ¶ä¸»é ç²å–ã€å€å¡Š |
| Chrome Debug Protocol | âœ… å®Œæˆ | å·²å¯¦ç¾ `_fetch_notes_via_cdp()` æ–¹æ³• |
| API ç²å– | âš ï¸ å—é™ | éœ€è¦åŠ å¯†ç°½åï¼Œè¿”å› 406 |
| ç¶²é çˆ¬å– | âš ï¸ å—é™ | æœªç™»å…¥åªèƒ½ç²å– 6 å€‹ç­†è¨˜ |
| Playwright è‡ªå‹•åŒ– | âš ï¸ å—é™ | éœ€è¦ cookiesï¼Œæ•ˆæœæœ‰é™ |
| æ‰¹é‡è™•ç† | âœ… å®Œæˆ | å¤šç·šç¨‹è™•ç†ã€é€²åº¦é¡¯ç¤ºå·²å¯¦ç¾ |

---

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

### ç›¸é—œæª”æ¡ˆ
```
~/MediaMiner/
â”œâ”€â”€ ui/app.py                           # UI ä»‹é¢ (å°ç´…æ›¸å€å¡Šåœ¨ line 550-700)
â”œâ”€â”€ scrapers/
â”‚   â”œâ”€â”€ xiaohongshu_scraper.py          # â­ æ ¸å¿ƒçˆ¬èŸ²é¡
â”‚   â””â”€â”€ transcript_fetcher.py           # å­—å¹•/èªéŸ³è¾¨è­˜
â””â”€â”€ processors/
    â””â”€â”€ knowledge_extractor.py          # çŸ¥è­˜æå–
```

### æ ¸å¿ƒé¡åˆ¥ï¼š`XiaohongshuScraper`

ä½ç½®ï¼š`~/MediaMiner/scrapers/xiaohongshu_scraper.py`

```python
class XiaohongshuScraper:
    def get_user_notes(self, url: str, max_notes: int = 0) -> List[Dict]:
        """
        ç²å–ç”¨æˆ¶æ‰€æœ‰ç­†è¨˜åˆ—è¡¨
        
        å„ªå…ˆé †åº:
        1. _fetch_notes_via_cdp()      # Chrome Debug Protocol (æœ€å¯é )
        2. _fetch_notes_via_api()      # å°ç´…æ›¸ API (éœ€è¦ç°½å)
        3. _fetch_notes_via_web()      # ç¶²é çˆ¬å–
        4. _fetch_notes_via_playwright() # Playwright è‡ªå‹•åŒ–
        
        Returns:
            [{'title': ..., 'url': ..., 'note_id': ..., 'type': 'video'|'image', ...}]
        """
```

### ç²å–æ–¹æ³•è©³è§£

#### 1. Chrome Debug Protocol (`_fetch_notes_via_cdp`)
- **ç‹€æ…‹**: âœ… å·²å¯¦ç¾ï¼Œå¾…æ¸¬è©¦
- **åŸç†**: é€£æ¥ç”¨æˆ¶å·²ç™»å…¥çš„ Chrome ç€è¦½å™¨ï¼Œåˆ©ç”¨å…¶ cookies è¨ªå•å°ç´…æ›¸
- **å„ªé»**: æœ€å¯é ï¼Œèƒ½ç²å–å®Œæ•´åˆ—è¡¨
- **ç¼ºé»**: éœ€è¦ç”¨æˆ¶æ‰‹å‹•å•Ÿå‹• Chrome Debug æ¨¡å¼

**ä½¿ç”¨æ­¥é©Ÿ**:
```bash
# 1. å®Œå…¨é—œé–‰ Chrome
# 2. åŸ·è¡Œä»¥ä¸‹å‘½ä»¤å•Ÿå‹• Debug æ¨¡å¼
/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome --remote-debugging-port=9222

# 3. åœ¨ Chrome ä¸­ç™»å…¥å°ç´…æ›¸
# 4. åœ¨ MediaMiner UI ä¸­è¼¸å…¥ä¸»é  URL ä¸¦ç²å–
```

#### 2. API ç²å– (`_fetch_notes_via_api`)
- **ç‹€æ…‹**: âŒ å—é™ï¼ˆè¿”å› 406ï¼‰
- **API ç«¯é»**: `https://edith.xiaohongshu.com/api/sns/web/v1/user_posted`
- **å•é¡Œ**: éœ€è¦ X-Sign åŠ å¯†ç°½åï¼Œç®—æ³•æœªçŸ¥

#### 3. ç¶²é çˆ¬å– (`_fetch_notes_via_web`)
- **ç‹€æ…‹**: âš ï¸ æœ‰é™ï¼ˆæœªç™»å…¥åªèƒ½ç²å– 6 å€‹ç­†è¨˜ï¼‰
- **å•é¡Œ**: å°ç´…æ›¸é™åˆ¶æœªç™»å…¥ç”¨æˆ¶åªèƒ½çœ‹åˆ°å°‘é‡å…§å®¹

#### 4. Playwright è‡ªå‹•åŒ– (`_fetch_notes_via_playwright`)
- **ç‹€æ…‹**: âš ï¸ æœ‰é™
- **å•é¡Œ**: ç„¡æ³•ç¹éç™»å…¥é™åˆ¶

---

## ğŸ¯ å¾…è¾¦äº‹é …

### é«˜å„ªå…ˆç´š

- [ ] **æ¸¬è©¦ Chrome Debug Protocol åŠŸèƒ½**
  - éœ€è¦ç”¨æˆ¶ç™»å…¥å°ç´…æ›¸å¾Œæ¸¬è©¦
  - é©—è­‰èƒ½å¦ç²å–å®Œæ•´ç­†è¨˜åˆ—è¡¨
  - æ¸¬è©¦æ»¾å‹•è¼‰å…¥æ˜¯å¦æ­£å¸¸

- [ ] **å„ªåŒ–ç­†è¨˜é¡å‹è­˜åˆ¥**
  - å€åˆ†å½±ç‰‡ç­†è¨˜å’Œåœ–æ–‡ç­†è¨˜
  - åªè™•ç†å½±ç‰‡ç­†è¨˜ï¼ˆåœ–æ–‡ç„¡æ³•èªéŸ³è¾¨è­˜ï¼‰

### ä¸­å„ªå…ˆç´š

- [ ] **ç ”ç©¶ X-Sign ç°½åç®—æ³•**
  - åˆ†æå°ç´…æ›¸å‰ç«¯ JS ä»£ç¢¼
  - å¯èƒ½éœ€è¦ä½¿ç”¨ `execjs` åŸ·è¡Œ JS

- [ ] **æ·»åŠ  cookies å°å…¥åŠŸèƒ½**
  - è®“ç”¨æˆ¶æ‰‹å‹•å°å‡º Chrome cookies
  - æ”¯æŒ Netscape cookies æ ¼å¼

- [ ] **å¯¦ç¾å¢é‡æ›´æ–°**
  - è¨˜éŒ„å·²è™•ç†çš„ç­†è¨˜ ID
  - åªè™•ç†æ–°å¢ç­†è¨˜

### ä½å„ªå…ˆç´š

- [ ] **æ”¯æŒæ›´å¤šå¹³å°**
  - æŠ–éŸ³ (Douyin)
  - Bç«™ (Bilibili)

---

## ğŸ”§ æ¸¬è©¦æ­¥é©Ÿ

### æ¸¬è©¦ Chrome Debug Protocol

```bash
# 1. çµ‚ç«¯åŸ·è¡Œ
cd ~/MediaMiner && source .venv/bin/activate

# 2. é‹è¡Œæ¸¬è©¦è…³æœ¬
python -c "
from scrapers.xiaohongshu_scraper import XiaohongshuScraper

scraper = XiaohongshuScraper()
notes = scraper.get_user_notes(
    'https://www.xiaohongshu.com/user/profile/5657c8d0a40e184e09f5144e',
    max_notes=0  # 0 = ç²å–å…¨éƒ¨
)

print(f'æ‰¾åˆ° {len(notes)} å€‹ç­†è¨˜')
for i, n in enumerate(notes[:10]):
    print(f'{i+1}. {n[\"title\"][:40]}... | {n[\"url\"]}')
"
```

### æ¸¬è©¦ UI

```bash
# å•Ÿå‹•æ‡‰ç”¨
cd ~/MediaMiner && source .venv/bin/activate
streamlit run ui/app.py --server.port 8502

# è¨ªå• http://localhost:8502
# é¸æ“‡ã€Œå°ç´…æ›¸ã€é é¢
```

---

## ğŸ“ å·²çŸ¥å•é¡Œ

### 1. API 406 éŒ¯èª¤
- **ç¾è±¡**: `_fetch_notes_via_api` è¿”å› 406
- **åŸå› **: ç¼ºå°‘ X-Sign è«‹æ±‚ç°½å
- **è§£æ±ºæ–¹æ¡ˆ**: 
  - çŸ­æœŸï¼šä½¿ç”¨ Chrome Debug Protocol
  - é•·æœŸï¼šé€†å‘å·¥ç¨‹ç°½åç®—æ³•

### 2. æœªç™»å…¥é™åˆ¶
- **ç¾è±¡**: åªèƒ½ç²å– 6 å€‹ç­†è¨˜
- **åŸå› **: å°ç´…æ›¸é™åˆ¶éŠå®¢è¨ªå•
- **è§£æ±ºæ–¹æ¡ˆ**: å¿…é ˆä½¿ç”¨ç™»å…¥ç‹€æ…‹ï¼ˆCDP æˆ– cookiesï¼‰

### 3. æ¨™é¡Œæå–ä¸å®Œæ•´
- **ç¾è±¡**: éƒ¨åˆ†ç­†è¨˜é¡¯ç¤ºç‚ºã€Œç­†è¨˜ xxx...ã€
- **åŸå› **: DOM çµæ§‹è®ŠåŒ–æˆ–æ¨™é¡Œå…ƒç´ ä¸å¯è¦‹
- **è§£æ±ºæ–¹æ¡ˆ**: å„ªåŒ– CSS é¸æ“‡å™¨æˆ–ä½¿ç”¨ yt-dlp ç²å–

---

## ğŸ”— ç›¸é—œè³‡æº

### å°ç´…æ›¸æŠ€è¡“è³‡æ–™
- API ç«¯é»: `https://edith.xiaohongshu.com/api/sns/web/v1/`
- ç”¨æˆ¶ç­†è¨˜: `/user_posted?num=30&cursor=&user_id={user_id}`
- ç­†è¨˜è©³æƒ…: `https://www.xiaohongshu.com/explore/{note_id}`

### ç¬¬ä¸‰æ–¹å·¥å…·åƒè€ƒ
- [MediaCrawler](https://github.com/NanmiCoder/MediaCrawler) - Python çˆ¬èŸ²æ¡†æ¶
- [xhs](https://github.com/ReaJason/xhs) - å°ç´…æ›¸ API å°è£

### ä¾è³´å¥—ä»¶
```bash
pip install playwright browser_cookie3 requests
playwright install chromium
```

---

## ğŸ“Š é€²åº¦è¿½è¹¤

| æ—¥æœŸ | é€²åº¦ | å‚™è¨» |
|------|------|------|
| 2025-12-30 | å¯¦ç¾ CDP æ–¹æ³• | æœªæ¸¬è©¦ï¼ˆéœ€ç™»å…¥ï¼‰ |
| 2025-12-30 | å„ªåŒ– UI ä»‹é¢ | æ·»åŠ èªªæ˜æ–‡æª” |
| å¾…å®š | æ¸¬è©¦å®Œæ•´æµç¨‹ | éœ€è¦ç™»å…¥å°ç´…æ›¸ |

---

## ğŸ’¡ çµ¦æœªä¾†é–‹ç™¼è€…çš„æç¤º

1. **é¦–é¸ Chrome Debug Protocol**: é€™æ˜¯ç›®å‰æœ€å¯é çš„æ–¹æ³•ï¼Œé›–ç„¶éœ€è¦ç”¨æˆ¶æ‰‹å‹•æ“ä½œï¼Œä½†èƒ½ç²å–å®Œæ•´æ•¸æ“š

2. **å°ç´…æ›¸åçˆ¬åš´æ ¼**: API éœ€è¦åŠ å¯†ç°½åï¼Œç¶²é é™åˆ¶æœªç™»å…¥ç”¨æˆ¶ï¼Œä¸è¦æµªè²»æ™‚é–“å˜—è©¦ç¹é

3. **æ¸¬è©¦ç”¨ URL**: 
   ```
   https://www.xiaohongshu.com/user/profile/5657c8d0a40e184e09f5144e
   ```
   é€™æ˜¯ã€Œé©¬æƒ³èŠAIã€çš„ä¸»é ï¼Œç”¨æ–¼é–‹ç™¼æ¸¬è©¦

4. **é—œéµä»£ç¢¼ä½ç½®**:
   - UI: `ui/app.py` line 570-630
   - çˆ¬èŸ²: `scrapers/xiaohongshu_scraper.py` å…¨éƒ¨
   - è™•ç†: `processors/knowledge_extractor.py`

5. **æ‰¹é‡è™•ç†å·²å®Œæˆ**: å¤šç·šç¨‹ã€é€²åº¦é¡¯ç¤ºã€éŒ¯èª¤è™•ç†éƒ½å·²å¯¦ç¾ï¼Œåªå·®ç­†è¨˜åˆ—è¡¨ç²å–

---

*æœ¬æ–‡æª”ç”± Antigravity AI è‡ªå‹•ç”Ÿæˆï¼Œç”¨æ–¼é–‹ç™¼æ¥çºŒ*
